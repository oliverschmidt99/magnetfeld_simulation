<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}Bibliothek & Stammdaten{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/library.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
{% endblock %}
{% block content %}
<div class="container">
    <div class="sub-nav-bar">
        <h2>Datenverwaltung</h2>
    </div>
    <div class="tabs">
        <button type="button" class="tab-link active" onclick="openTab(event, 'components')">Bauteil-Bibliothek
            (JSON)</button>
        <button type="button" class="tab-link" onclick="openTab(event, 'materials')">Material-Bibliothek</button>
        <button type="button" class="tab-link" onclick="openTab(event, 'master-data')">Stammdaten (CSV)</button>
    </div>

    <div id="components" class="tab-content active">
        <div id="editor-container">
            <div class="filter-bar">
                <div class="form-group">
                    <label for="component-type-filter">Bauteiltyp</label>
                    <select id="component-type-filter">
                        <option value="all">Alle Typen</option>
                        <option value="transformers">Wandler</option>
                        <option value="copperRails">Kupferschienen</option>
                        <option value="transformerSheets">Abschirmbleche</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="search-filter">Suche nach Name</label>
                    <input type="text" id="search-filter" placeholder="z.B. CELSA_ALO...">
                </div>
                <div class="form-group">
                    <button type="button" id="add-new-component-btn" class="button">Neues Bauteil</button>
                </div>
            </div>

            <div id="component-list-accordion">
            </div>

            <div id="component-type-modal" class="modal-overlay initially-hidden">
                <div class="modal-content">
                    <h2>Welchen Bauteiltyp möchtest du erstellen?</h2>
                    <div class="button-group modal-button-group-centered">
                        <button type="button" id="select-transformer" class="button">Wandler</button>
                        <button type="button" id="select-copperRail" class="button">Kupferschiene</button>
                        <button type="button" id="select-transformerSheet" class="button">Abschirmblech</button>
                    </div>
                    <div class="button-group">
                        <button type="button" id="cancel-type-selection" class="button secondary">Abbrechen</button>
                    </div>
                </div>
            </div>


            <div id="component-editor-modal" class="modal-overlay initially-hidden">
                <div class="modal-content">
                    <h2 id="editor-title">Bauteil bearbeiten</h2>
                    <div class="editor-layout">
                        <form id="component-editor-form" class="component-form">
                            <button type="submit" class="hidden" aria-label="Submit Form"></button>
                        </form>
                        <div class="component-preview-container">
                            <h3>Vorschau</h3>
                            <div class="component-preview">
                                <svg id="editor-preview-svg"></svg>
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" id="save-component-btn" class="button">Speichern</button>
                        <button type="button" id="delete-component-btn" class="button danger">Löschen</button>
                        <button type="button" id="cancel-edit-btn" class="button secondary">Abbrechen</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="tag-selection-modal" class="modal-overlay initially-hidden">
            <div class="modal-content">
                <h2>Tags auswählen</h2>
                <div class="search-container">
                    <input type="text" id="tag-search-input" placeholder="Tag suchen...">
                </div>
                <div id="modal-tag-list">
                </div>
                <div class="button-group">
                    <button type="button" id="save-tags-btn" class="button">Übernehmen</button>
                    <button type="button" id="cancel-tags-btn" class="button secondary">Abbrechen</button>
                </div>
            </div>
        </div>
    </div>

    <div id="materials" class="tab-content">
        <h3>Material-Bibliothek verwalten</h3>
        <p>Hier kannst du Materialien mit linearen Eigenschaften oder nichtlinearen B-H-Kurven definieren.</p>
        <div class="filter-bar">
            <button type="button" id="add-new-material-btn" class="button">Neues Material hinzufügen</button>
        </div>
        <div id="material-list">
        </div>
    </div>

    <div id="master-data" class="tab-content">
        <h3>Stammdaten-Editor (CSV-Dateien)</h3>
        <p>Platzhalter: Der Editor für die CSV-Stammdaten wird hier geladen.</p>
    </div>
</div>

<div id="material-editor-modal" class="modal-overlay initially-hidden">
    <div class="modal-content">
        <h2 id="material-editor-title">Material bearbeiten</h2>

        <div class="material-editor-layout">

            <div class="component-preview-container">
                <h3>Vorschau der B-H Kurve</h3>
                <div class="component-preview">
                    <canvas id="bh-curve-chart"></canvas>
                </div>
            </div>

            <div class="component-form">
                <div class="form-section">
                    <h3>Allgemein</h3>
                    <div class="form-group">
                        <label for="material-name">Name</label>
                        <input type="text" id="material-name" required>
                    </div>
                </div>
                <div class="form-section">
                    <h3>Eigenschaften</h3>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="material-is-nonlinear">
                        <label for="material-is-nonlinear">Nichtlineare B-H Kurve verwenden</label>
                    </div>
                    <div class="form-group" id="linear-mu-group">
                        <label>Lineare Relative Permeabilität (µr)</label>
                        <input type="number" id="material-mur" value="1" step="100">
                    </div>
                </div>
                <div class="form-section initially-hidden" id="nonlinear-bh-group">
                    <h3>B-H Kurvenpunkte</h3>
                    <p>Füge hier die Punkte der Hysteresekurve hinzu.</p>
                    <table class="summary-table" id="bh-curve-table">
                        <thead>
                            <tr>
                                <th>Flussdichte B (Tesla)</th>
                                <th>Feldstärke H (A/m)</th>
                                <th>Aktion</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <button type="button" id="add-bh-point-btn" class="button secondary btn-margin-top">+ Punkt
                        hinzufügen</button>
                </div>
            </div>

        </div>

        <div class="button-group">
            <button type="button" id="save-material-btn" class="button">Speichern</button>
            <button type="button" id="delete-material-btn" class="button danger">Löschen</button>
            <button type="button" id="cancel-material-edit-btn" class="button secondary">Abbrechen</button>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/tags.js') }}"></script>
<script src="{{ url_for('static', filename='js/preview.js') }}"></script>
<script src="{{ url_for('static', filename='js/editor.js') }}"></script>
<script src="{{ url_for('static', filename='js/materials.js') }}"></script>
<script src="{{ url_for('static', filename='js/library.js') }}"></script>
{% endblock %}
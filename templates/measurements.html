<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}Messungen{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/measurements.css') }}">
{% endblock %}

{% block sub_nav %}
<div class="sub-nav-bar">
    <h2>Messwerterfassung &amp; Analyse</h2>
</div>
{% endblock %}

{% block content %}
<script id="library-data" type="application/json">
    {{ library|tojson|safe }}
</script>

<div class="container measurement-container">
    <div class="card">
        <div class="top-controls-grid">
            <div class="form-group">
                <label for="strom-gruppe-selector">1. Strom Gruppe wählen</label>
                <select id="strom-gruppe-selector">
                    <option value="">-- Gruppe wählen --</option>
                    <option value="A">Gruppe A (600A - 800A)</option>
                    <option value="B">Gruppe B (1000A - 2500A)</option>
                    <option value="C">Gruppe C (3000A - 5000A)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="transformer-selector">2. Wandler für alle Phasen wählen</label>
                <select id="transformer-selector" disabled>
                    <option value="">-- Bitte Gruppe wählen --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="accuracy-class-selector">3. Genauigkeitsklasse</label>
                <select id="accuracy-class-selector">
                    <option value="all">Alle Klassen</option>
                    <option value="0.1">Klasse 0.1</option>
                    <option value="0.2">Klasse 0.2</option>
                    <option value="0.5">Klasse 0.5</option>
                    <option value="1.0">Klasse 1.0</option>
                </select>
            </div>
            <div class="overall-status" id="overall-status">
                Messung vollständig: <span class="status-value incomplete">Nein</span> | <span
                    class="status-date">--.--.----</span>
            </div>
        </div>
    </div>

    <div class="phase-input-grid" id="phase-grid">
        {% for phase in ["L1", "L2", "L3"] %}
        <div class="card phase-context" id="context-{{phase}}">
            <div class="phase-header">
                <h3>Messwerte für {{phase}}</h3>
            </div>
            <div class="accordion">

                <div class="accordion-item">
                    <button class="accordion-button" data-accordion-group="group-1">
                        <input type="checkbox" disabled> 1. Leerlauf- &amp; Kurzschlussversuch
                    </button>
                    <div class="accordion-content">
                        <div class="test-grid">
                            <div class="card">
                                <h5>Leerlaufversuch</h5>
                                <div class="form-group"><label><i>U</i><sub>L</sub> (V)</label><input type="number"
                                        class="measurement-input" id="u-leerlauf-{{phase}}" step="any"></div>
                                <div class="form-group"><label><i>I</i><sub>L</sub> (A)</label><input type="number"
                                        class="measurement-input" id="i-leerlauf-{{phase}}" step="any"></div>
                                <div class="form-group"><label><i>P</i><sub>L</sub> (W)</label><input type="number"
                                        class="measurement-input" id="p-leerlauf-{{phase}}" step="any"></div>
                            </div>
                            <div class="card">
                                <h5>Kurzschlussversuch</h5>
                                <div class="form-group"><label><i>U</i><sub>K</sub> (V)</label><input type="number"
                                        class="measurement-input" id="u-kurzschluss-{{phase}}" step="any"></div>
                                <div class="form-group"><label><i>I</i><sub>K</sub> (A)</label><input type="number"
                                        class="measurement-input" id="i-kurzschluss-{{phase}}" step="any"></div>
                                <div class="form-group"><label><i>P</i><sub>K</sub> (W)</label><input type="number"
                                        class="measurement-input" id="p-kurzschluss-{{phase}}" step="any"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-button" data-accordion-group="group-2">
                        <input type="checkbox" disabled> 2. Sekundärwicklungs-Parameter
                    </button>
                    <div class="accordion-content">
                        <div class="resistance-measurement-section">
                            <h5>Widerstand (<i>R</i><sub>S</sub>)</h5>
                            <div class="form-group"><label><i>U</i><sub>mess</sub> (V)</label><input type="number"
                                    id="u-mess-{{phase}}" class="measurement-input resistance-calc-input"
                                    data-phase="{{phase}}" step="0.001"></div>
                            <div class="form-group"><label><i>I</i><sub>mess</sub> (A)</label><input type="number"
                                    id="i-mess-{{phase}}" class="measurement-input resistance-calc-input"
                                    data-phase="{{phase}}" step="0.001"></div>
                            <div class="resistance-result"><i>R</i><sub>S</sub>: <span id="rs-result-{{phase}}">--
                                    Ω</span></div>
                        </div>
                        <div class="inductance-measurement-section">
                            <h5>Induktivität (<i>L</i><sub>S</sub>)</h5>
                            <div class="form-group"><label><i>U</i><sub>mess</sub> (V)</label><input type="number"
                                    id="u-mess-L-{{phase}}" class="measurement-input inductance-calc-input"
                                    data-phase="{{phase}}" step="0.001"></div>
                            <div class="form-group"><label><i>I</i><sub>mess</sub> (A)</label><input type="number"
                                    id="i-mess-L-{{phase}}" class="measurement-input inductance-calc-input"
                                    data-phase="{{phase}}" step="0.001"></div>
                            <div class="form-group"><label>Phasenverschiebung φ (°)</label><input type="number"
                                    id="phi-mess-L-{{phase}}" class="measurement-input inductance-calc-input"
                                    data-phase="{{phase}}" step="0.1"></div>
                            <div class="inductance-result"><i>X</i><sub>S</sub>: <span id="xs-result-{{phase}}">--
                                    Ω</span> | <i>L</i><sub>S</sub>: <span id="ls-result-{{phase}}">-- mH</span></div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-button" data-accordion-group="group-burden">Bürden-Analyse &amp;
                        Kompensation</button>
                    <div class="accordion-content" id="burden-content-{{phase}}">
                    </div>
                </div>

                {% for pos in [1, 2, 3] %}
                <div class="accordion-item">
                    <button class="accordion-button" data-accordion-group="group-pos-{{pos}}">
                        <input type="checkbox" disabled> {{ 2 + pos }}. Messreihe Position {{pos}} {% if pos == 3
                        %}(optional){% endif %}
                    </button>
                    <div class="accordion-content">
                        <div class="table-wrapper">
                            <table class="summary-table measurement-table" id="measurement-table-pos{{pos}}-{{phase}}">
                                <thead>
                                    <tr>
                                        <th>%</th>
                                        <th><i>I</i><sub>prim</sub> (A)</th>
                                        <th><i>I</i><sub>sek</sub> (mA)</th>
                                        <th>Fehler (%)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for p in [5, 20, 100, 120] %}
                                    <tr data-percent="{{p}}" data-pos="{{pos}}" data-phase="{{phase}}">
                                        <td>{{p}}% <span class="subtle-text" id="soll-strom-{{p}}-{{phase}}"></span>
                                        </td>
                                        <td><input type="number" class="measurement-input iprim" step="0.1"></td>
                                        <td><input type="number" class="measurement-input isek" step="0.01"></td>
                                        <td class="error-cell">--</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="form-group save-button-container">
        <button type="button" id="save-all-btn" class="button large-button">Alle Messungen speichern</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/measurements.js') }}"></script>
{% endblock %}
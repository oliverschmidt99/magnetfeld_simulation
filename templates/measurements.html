<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}Messungen{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/measurements.css') }}">
{% endblock %}

{% block sub_nav %}
<div class="sub-nav-bar">
    <h2>Messwerterfassung &amp; Analyse</h2>
</div>
{% endblock %}

{% block content %}
<script id="library-data" type="application/json">
    {{ library|tojson|safe }}
</script>

<div class="container measurement-container">
    <div class="card global-controls">
        <div class="form-group">
            <label for="strom-gruppe-selector">1. Strom Gruppe wählen</label>
            <select id="strom-gruppe-selector">
                <option value="">-- Gruppe wählen --</option>
                <option value="A">Gruppe A (600A - 800A)</option>
                <option value="B">Gruppe B (1000A - 2500A)</option>
                <option value="C">Gruppe C (3000A - 5000A)</option>
            </select>
        </div>
        <div class="form-group">
            <label for="transformer-selector">2. Wandler für alle Phasen wählen</label>
            <select id="transformer-selector" disabled>
                <option value="">-- Bitte Gruppe wählen --</option>
            </select>
        </div>
        <div class="form-group">
            <label for="accuracy-class-selector">Genauigkeitsklasse</label>
            <select id="accuracy-class-selector">
                <option value="all">Alle Klassen</option>
                <option value="0.1">Klasse 0.1</option>
                <option value="0.2">Klasse 0.2</option>
                <option value="0.5">Klasse 0.5</option>
                <option value="1.0">Klasse 1.0</option>
            </select>
        </div>
        <div class="form-group">
            <button type="button" id="save-all-btn" class="button">Alle Messungen speichern</button>
        </div>
    </div>

    <div class="phase-input-grid">
        <div class="card phase-context" id="context-L1">
            <h3>Messwerte für L1</h3>
            <div class="resistance-measurement-section">
                <h4>1. Sekundärwiderstand (R_S)</h4>
                <div class="form-group">
                    <label>U_mess (V)</label>
                    <input type="number" id="u-mess-L1" class="resistance-calc-input" step="0.001">
                </div>
                <div class="form-group">
                    <label>I_mess (A)</label>
                    <input type="number" id="i-mess-L1" class="resistance-calc-input" step="0.001">
                </div>
                <div class="resistance-result">
                    R_S: <span id="rs-result-L1">-- Ω</span>
                </div>
            </div>

            <div class="burden-calculation-section">
                <h4>2. Bürdenberechnung (Last)</h4>
                <div class="form-group">
                    <label>Temperatur für ρ</label>
                    <div class="button-group-radio">
                        <input type="radio" id="temp-20-L1" name="temp-selector-L1" value="20" checked><label
                            for="temp-20-L1">20°C</label>
                        <input type="radio" id="temp-80-L1" name="temp-selector-L1" value="80"><label
                            for="temp-80-L1">80°C</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="cable-length-L1">Kabellänge (Hin+Zurück in m)</label>
                    <input type="number" id="cable-length-L1" class="burden-calc-input" step="0.1" value="2.0">
                </div>
                <div class="form-group">
                    <label for="cable-cross-section-L1">Kabelquerschnitt (mm²)</label>
                    <select id="cable-cross-section-L1" class="burden-calc-input">
                        <option value="0.5">0,5</option>
                        <option value="0.75">0,75</option>
                        <option value="1.0" selected>1,0</option>
                        <option value="1.5">1,5</option>
                        <option value="2.5">2,5</option>
                        <option value="4.0">4,0</option>
                        <option value="6.0">6,0</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="meter-resistance-L1">Messgerät-Innenwiderstand (Ω)</label>
                    <input type="number" id="meter-resistance-L1" class="burden-calc-input" step="0.01" value="0.1">
                </div>
                <div class="burden-result">
                    R_Kabel: <span id="rcable-result-L1">-- Ω</span>
                </div>
            </div>

            <div class="total-burden-section">
                <h4>3. Gesamtbürde</h4>
                <div class="form-group">
                    <label for="burden-resistance-L1">Gesamtbürde R_B (Ω)</label>
                    <input type="number" id="burden-resistance-L1" class="burden-input" step="0.0001" readonly>
                </div>
                <div class="burden-result">
                    Gesamtbürde S_B: <span id="sburden-result-L1">-- VA</span>
                </div>
                <div id="burden-status-L1" class="burden-status">
                    <span>Status: --</span>
                </div>
            </div>

            <div class="table-wrapper">
                <h4>4. Messpunkte</h4>
                <table class="summary-table measurement-table" id="measurement-table-L1">
                    <thead>
                        <tr>
                            <th>%</th>
                            <th>I_prim (A)</th>
                            <th>I_sek (mA)</th>
                            <th>Fehler (%)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <span class="last-saved-span" id="last-saved-L1"></span>
        </div>

        <div class="card phase-context" id="context-L2">
            <h3>Messwerte für L2</h3>
            <div class="resistance-measurement-section">
                <h4>1. Sekundärwiderstand (R_S)</h4>
                <div class="form-group">
                    <label>U_mess (V)</label>
                    <input type="number" id="u-mess-L2" class="resistance-calc-input" step="0.001">
                </div>
                <div class="form-group">
                    <label>I_mess (A)</label>
                    <input type="number" id="i-mess-L2" class="resistance-calc-input" step="0.001">
                </div>
                <div class="resistance-result">
                    R_S: <span id="rs-result-L2">-- Ω</span>
                </div>
            </div>

            <div class="burden-calculation-section">
                <h4>2. Bürdenberechnung (Last)</h4>
                <div class="form-group">
                    <label>Temperatur für ρ</label>
                    <div class="button-group-radio">
                        <input type="radio" id="temp-20-L2" name="temp-selector-L2" value="20" checked><label
                            for="temp-20-L2">20°C</label>
                        <input type="radio" id="temp-80-L2" name="temp-selector-L2" value="80"><label
                            for="temp-80-L2">80°C</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="cable-length-L2">Kabellänge (Hin+Zurück in m)</label>
                    <input type="number" id="cable-length-L2" class="burden-calc-input" step="0.1" value="2.0">
                </div>
                <div class="form-group">
                    <label for="cable-cross-section-L2">Kabelquerschnitt (mm²)</label>
                    <select id="cable-cross-section-L2" class="burden-calc-input">
                        <option value="0.5">0,5</option>
                        <option value="0.75">0,75</option>
                        <option value="1.0" selected>1,0</option>
                        <option value="1.5">1,5</option>
                        <option value="2.5">2,5</option>
                        <option value="4.0">4,0</option>
                        <option value="6.0">6,0</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="meter-resistance-L2">Messgerät-Innenwiderstand (Ω)</label>
                    <input type="number" id="meter-resistance-L2" class="burden-calc-input" step="0.01" value="0.1">
                </div>
                <div class="burden-result">
                    R_Kabel: <span id="rcable-result-L2">-- Ω</span>
                </div>
            </div>

            <div class="total-burden-section">
                <h4>3. Gesamtbürde</h4>
                <div class="form-group">
                    <label for="burden-resistance-L2">Gesamtbürde R_B (Ω)</label>
                    <input type="number" id="burden-resistance-L2" class="burden-input" step="0.0001" readonly>
                </div>
                <div class="burden-result">
                    Gesamtbürde S_B: <span id="sburden-result-L2">-- VA</span>
                </div>
                <div id="burden-status-L2" class="burden-status">
                    <span>Status: --</span>
                </div>
            </div>

            <div class="table-wrapper">
                <h4>4. Messpunkte</h4>
                <table class="summary-table measurement-table" id="measurement-table-L2">
                    <thead>
                        <tr>
                            <th>%</th>
                            <th>I_prim (A)</th>
                            <th>I_sek (mA)</th>
                            <th>Fehler (%)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <span class="last-saved-span" id="last-saved-L2"></span>
        </div>

        <div class="card phase-context" id="context-L3">
            <h3>Messwerte für L3</h3>
            <div class="resistance-measurement-section">
                <h4>1. Sekundärwiderstand (R_S)</h4>
                <div class="form-group">
                    <label>U_mess (V)</label>
                    <input type="number" id="u-mess-L3" class="resistance-calc-input" step="0.001">
                </div>
                <div class="form-group">
                    <label>I_mess (A)</label>
                    <input type="number" id="i-mess-L3" class="resistance-calc-input" step="0.001">
                </div>
                <div class="resistance-result">
                    R_S: <span id="rs-result-L3">-- Ω</span>
                </div>
            </div>

            <div class="burden-calculation-section">
                <h4>2. Bürdenberechnung (Last)</h4>
                <div class="form-group">
                    <label>Temperatur für ρ</label>
                    <div class="button-group-radio">
                        <input type="radio" id="temp-20-L3" name="temp-selector-L3" value="20" checked><label
                            for="temp-20-L3">20°C</label>
                        <input type="radio" id="temp-80-L3" name="temp-selector-L3" value="80"><label
                            for="temp-80-L3">80°C</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="cable-length-L3">Kabellänge (Hin+Zurück in m)</label>
                    <input type="number" id="cable-length-L3" class="burden-calc-input" step="0.1" value="2.0">
                </div>
                <div class="form-group">
                    <label for="cable-cross-section-L3">Kabelquerschnitt (mm²)</label>
                    <select id="cable-cross-section-L3" class="burden-calc-input">
                        <option value="0.5">0,5</option>
                        <option value="0.75">0,75</option>
                        <option value="1.0" selected>1,0</option>
                        <option value="1.5">1,5</option>
                        <option value="2.5">2,5</option>
                        <option value="4.0">4,0</option>
                        <option value="6.0">6,0</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="meter-resistance-L3">Messgerät-Innenwiderstand (Ω)</label>
                    <input type="number" id="meter-resistance-L3" class="burden-calc-input" step="0.01" value="0.1">
                </div>
                <div class="burden-result">
                    R_Kabel: <span id="rcable-result-L3">-- Ω</span>
                </div>
            </div>

            <div class="total-burden-section">
                <h4>3. Gesamtbürde</h4>
                <div class="form-group">
                    <label for="burden-resistance-L3">Gesamtbürde R_B (Ω)</label>
                    <input type="number" id="burden-resistance-L3" class="burden-input" step="0.0001" readonly>
                </div>
                <div class="burden-result">
                    Gesamtbürde S_B: <span id="sburden-result-L3">-- VA</span>
                </div>
                <div id="burden-status-L3" class="burden-status">
                    <span>Status: --</span>
                </div>
            </div>

            <div class="table-wrapper">
                <h4>4. Messpunkte</h4>
                <table class="summary-table measurement-table" id="measurement-table-L3">
                    <thead>
                        <tr>
                            <th>%</th>
                            <th>I_prim (A)</th>
                            <th>I_sek (mA)</th>
                            <th>Fehler (%)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <span class="last-saved-span" id="last-saved-L3"></span>
        </div>
    </div>

    <div class="diagram-grid">
        <div id="chart-container-L1" class="card chart-card">
            <h4>Fehlerdiagramm L1</h4>
            <div class="chart-wrapper">
                <canvas id="error-chart-L1"></canvas>
            </div>
        </div>
        <div id="chart-container-L2" class="card chart-card">
            <h4>Fehlerdiagramm L2</h4>
            <div class="chart-wrapper">
                <canvas id="error-chart-L2"></canvas>
            </div>
        </div>
        <div id="chart-container-L3" class="card chart-card">
            <h4>Fehlerdiagramm L3</h4>
            <div class="chart-wrapper">
                <canvas id="error-chart-L3"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/measurements.js') }}"></script>
{% endblock %}
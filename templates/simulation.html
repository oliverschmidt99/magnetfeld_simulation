<!DOCTYPE html>
{% extends "base.html" %}

{% block title %}Simulation{% endblock %}

{% block sub_nav %}
<div class="sub-nav-bar">
    <h2>Simulation durchführen</h2>
</div>
{% endblock %}

{% block content %}
<div class="container">
    <form id="run-simulation-form">
        <div class="form-section">
            <h3>1. Basiskonfiguration auswählen</h3>
            <div class="form-group">
                <label for="base-scenario-select">Gespeicherte Konfiguration</label>
                <select id="base-scenario-select" required>
                    <option value="">-- Bitte eine Konfiguration laden --</option>
                </select>
            </div>
            <div class="button-group">
                <button type="button" id="load-base-scenario-btn">Konfiguration laden & anzeigen</button>
            </div>
            <div id="config-preview"
                style="margin-top: 1rem; padding: 1rem; background-color: #f8f9fa; border-radius: 4px; display: none;">
                <h4>Geladene Konfiguration:</h4>
                <pre id="config-json-preview" style="white-space: pre-wrap; word-wrap: break-word;"></pre>
            </div>
        </div>

        <hr>

        <div class="form-section">
            <h3>2. Parametrische Analyse definieren</h3>

            <div class="form-section"
                style="background-color: #f0f8ff; border: 1px solid #a7d7ff; margin-bottom: 1.5rem; padding: 1rem;">
                <h4>Phasendurchlauf (Für alle Szenarien)</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="phase-start">Start-Winkel (°)</label>
                        <input type="number" id="phase-start" value="0" step="1">
                    </div>
                    <div class="form-group">
                        <label for="phase-end">End-Winkel (°)</label>
                        <input type="number" id="phase-end" value="90" step="1">
                    </div>
                    <div class="form-group">
                        <label for="phase-step-size">Schrittweite (°)</label>
                        <input type="number" id="phase-step-size" value="15" min="1">
                    </div>
                </div>
            </div>

            <div id="analysis-type" class="scenario-details" style="display: none;">
                <h4>Szenario-Typ (Zusätzliche Variation)</h4>
                <select id="analysis-type">
                    <option value="none" selected>Keine - Nur Phasendurchlauf</option>
                    <option value="current">Stromstärke variieren</option>
                    <option value="distance">Abstand anpassen</option>
                    <option value="shielding">Abschirmblech hinzufügen/verschieben</option>
                </select>
            </div>

            <div id="current-scenario" class="scenario-details" style="display: none;">
                <h4>Stromstärke ansteigen lassen</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="current-start">Start-Strom (A, Peak)</label>
                        <input type="number" id="current-start" value="1000">
                    </div>
                    <div class="form-group">
                        <label for="current-end">End-Strom (A, Peak)</label>
                        <input type="number" id="current-end" value="5000">
                    </div>
                    <div class="form-group">
                        <label for="current-step-size">Schrittweite (Δstrom)</label>
                        <input type="number" id="current-step-size" value="1000">
                    </div>
                </div>
            </div>

            <div id="distance-scenario" class="scenario-details" style="display: none;">
                <h4>Abstand anpassen</h4>
                <div class="form-group">
                    <label for="distance-assembly">Welche Baugruppe soll verschoben werden?</label>
                    <select id="distance-assembly"></select>
                </div>
                <div class="form-row">
                    <div class="form-group"><label for="distance-x-start">Start X (mm)</label><input type="number"
                            id="distance-x-start"></div>
                    <div class="form-group"><label for="distance-x-end">Ende X (mm)</label><input type="number"
                            id="distance-x-end"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label for="distance-y-start">Start Y (mm)</label><input type="number"
                            id="distance-y-start"></div>
                    <div class="form-group"><label for="distance-y-end">Ende Y (mm)</label><input type="number"
                            id="distance-y-end"></div>
                </div>
                <div class="form-group">
                    <label for="distance-step-size">Schrittweite (Δabstand in mm)</label>
                    <input type="number" id="distance-step-size" value="50">
                </div>
            </div>

            <div id="shielding-scenario" class="scenario-details" style="display: none;">
                <h4>Abschirmblech hinzufügen/verschieben</h4>
                <p>Das ausgewählte Blech wird zur Konfiguration hinzugefügt und seine Position variiert.</p>
                <div class="form-group">
                    <label for="shielding-sheet">Welches Trafoblech?</label>
                    <select id="shielding-sheet"></select>
                </div>
                <div class="form-row">
                    <div class="form-group"><label for="shielding-x-start">Start X (mm)</label><input type="number"
                            id="shielding-x-start" value="0"></div>
                    <div class="form-group"><label for="shielding-x-end">Ende X (mm)</label><input type="number"
                            id="shielding-x-end" value="200"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label for="shielding-y-start">Start Y (mm)</label><input type="number"
                            id="shielding-y-start" value="100"></div>
                    <div class="form-group"><label for="shielding-y-end">Ende Y (mm)</label><input type="number"
                            id="shielding-y-end" value="100"></div>
                </div>
                <div class="form-group">
                    <label for="shielding-step-size">Schrittweite (Δabstand in mm)</label>
                    <input type="number" id="shielding-step-size" value="50">
                </div>
            </div>
        </div>

        <hr>
        <div class="button-group">
            <button type="submit" id="run-simulation-btn" disabled>Simulation starten</button>
        </div>
        <div id="simulation-status" style="margin-top: 1rem;"></div>

    </form>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/simulation.js') }}"></script>
{% endblock %}
<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}Simulation{% endblock %}
{% block sub_nav %}
<div class="sub-nav-bar">
    <h2>Simulation Konfigurieren &amp; Starten</h2>
</div>
{% endblock %}

{% block content %}
<script id="library-data" type="application/json">
    {{ library|tojson|safe }}
</script>
<script id="spielraum-data" type="application/json">
    {{ spielraum_data|tojson|safe }}
</script>
<script id="schrittweiten-data" type="application/json">
    {{ schrittweiten_data|tojson|safe }}
</script>
<script id="startpos-data" type="application/json">
    {{ startpos_data|tojson|safe }}
</script>


<div class="container">
    <div class="card-container" id="config-nav">
        <div class="card active" data-target="config-params">
            <h3>Allgemeine Parameter</h3>
            <p>Grundeinstellungen für die Simulation.</p>
        </div>
        <div class="card" data-target="config-phases">
            <h3>Elektrisches System</h3>
            <p>Phasen (L1, L2, etc.) definieren.</p>
        </div>
        <div class="card" data-target="config-assemblies">
            <h3>Baugruppen</h3>
            <p>Leiter und Wandler positionieren.</p>
        </div>
        <div class="card" data-target="config-standalone">
            <h3>Eigenständige Bauteile</h3>
            <p>Abschirmbleche etc. hinzufügen.</p>
        </div>
        <div class="card" data-target="config-summary">
            <h3>Übersicht &amp; Vorschau</h3>
            <p>Visuelle Kontrolle der Parameter.</p>
        </div>
    </div>
    <hr>
    <form id="simulation-form">
        <div id="config-sections">
            <div id="config-params" class="config-section active">
                <h2>Allgemeine Simulations-Parameter</h2>
                <div class="form-group-wrapper">
                    <div class="form-group"><label for="ratedCurrent">Nennstrom (A) - Setzt Standardwerte &amp; filtert
                            Wandler</label><select id="ratedCurrent">
                            <option value="600">600 A</option>
                            <option value="800">800 A</option>
                            <option value="1000">1000 A</option>
                            <option value="1250">1250 A</option>
                            <option value="1600">1600 A</option>
                            <option value="2000">2000 A</option>
                            <option value="2500">2500 A</option>
                            <option value="3000">3000 A</option>
                            <option value="4000">4000 A</option>
                            <option value="5000">5000 A</option>
                        </select></div>

                    <h4>Startpositionen (mm)</h4>
                    <div class="form-row">
                        <div class="form-group"><label for="startX_L1">L1 - X</label><input type="number" step="0.1"
                                id="startX_L1"></div>
                        <div class="form-group"><label for="startY_L1">L1 - Y</label><input type="number" step="0.1"
                                id="startY_L1"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label for="startX_L2">L2 - X</label><input type="number" step="0.1"
                                id="startX_L2"></div>
                        <div class="form-group"><label for="startY_L2">L2 - Y</label><input type="number" step="0.1"
                                id="startY_L2"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label for="startX_L3">L3 - X</label><input type="number" step="0.1"
                                id="startX_L3"></div>
                        <div class="form-group"><label for="startY_L3">L3 - Y</label><input type="number" step="0.1"
                                id="startY_L3"></div>
                    </div>

                    <h4>Bewegungsrichtungen</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="directionL1">Leiter L1</label>
                            <select id="directionL1">
                                {% for direction in direction_options %}
                                <option value="{{ direction.value }}">{{ direction.text }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="directionL2">Leiter L2</label>
                            <select id="directionL2">
                                {% for direction in direction_options %}
                                <option value="{{ direction.value }}">{{ direction.text }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="directionL3">Leiter L3</label>
                            <select id="directionL3">
                                {% for direction in direction_options %}
                                <option value="{{ direction.value }}">{{ direction.text }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="form-group"><label for="problemDepthM">Problem-Tiefe (mm)</label><input type="number"
                            step="1" id="problemDepthM" value="10"></div>

                    <h4>Simulationsraum (Spielraum)</h4>
                    <div class="form-row">
                        <div class="form-group"><label for="spielraumLaenge">Länge (mm)</label><input type="number"
                                step="0.1" id="spielraumLaenge" value="680.0"></div>
                        <div class="form-group"><label for="spielraumBreite">Breite (mm)</label><input type="number"
                                step="0.1" id="spielraumBreite" value="232.5"></div>
                    </div>

                    <h4>Schrittweiten (mm)</h4>
                    <div class="form-row">
                        <div class="form-group"><label for="schrittweitePos1">Pos 1</label><input type="number" step="1"
                                id="schrittweitePos1" value="0"></div>
                        <div class="form-group"><label for="schrittweitePos2">Pos 2</label><input type="number" step="1"
                                id="schrittweitePos2" value="0"></div>
                        <div class="form-group"><label for="schrittweitePos3">Pos 3</label><input type="number" step="1"
                                id="schrittweitePos3" value="0"></div>
                        <div class="form-group"><label for="schrittweitePos4">Pos 4</label><input type="number" step="1"
                                id="schrittweitePos4" value="0"></div>
                    </div>

                    <h4>Gemessene Sekundärströme (A)</h4>
                    <div class="form-row">
                        <div class="form-group"><label for="I_1_mes">I_1_mes</label><input type="number" step="0.01"
                                id="I_1_mes" value="0"></div>
                        <div class="form-group"><label for="I_2_mes">I_2_mes</label><input type="number" step="0.01"
                                id="I_2_mes" value="0"></div>
                        <div class="form-group"><label for="I_3_mes">I_3_mes</label><input type="number" step="0.01"
                                id="I_3_mes" value="0"></div>
                    </div>

                    <h4>Phasenwinkel-Sweep</h4>
                    <div class="form-row">
                        <div class="form-group"><label for="phaseStart">Start (°)</label><input type="number"
                                id="phaseStart" value="0"></div>
                        <div class="form-group"><label for="phaseEnd">Ende (°)</label><input type="number" id="phaseEnd"
                                value="180"></div>
                        <div class="form-group"><label for="phaseStep">Schritt (°)</label><input type="number"
                                id="phaseStep" value="5"></div>
                    </div>
                </div>
            </div>
            <div id="config-phases" class="config-section">
                <h2>Elektrisches System (Phasen)</h2>
                <p class="info-text">Strom wird vom Nennstrom übernommen.</p>
                <div id="electrical-system-list" class="dynamic-list"></div><button type="button" onclick="addPhase()">+
                    Phase hinzufügen</button>
            </div>
            <div id="config-assemblies" class="config-section">
                <h2>Baugruppen (Assemblies)</h2>
                <p class="info-text">Positionen werden automatisch berechnet.</p>
                <div id="assemblies-list" class="dynamic-list"></div><button type="button" onclick="addAssembly()">+
                    Baugruppe hinzufügen</button>
            </div>
            <div id="config-standalone" class="config-section">
                <h2>Eigenständige Bauteile</h2>
                <div id="standalone-list" class="dynamic-list"></div><button type="button" onclick="addStandalone()">+
                    Bauteil hinzufügen</button>
            </div>

            <div id="config-summary" class="config-section">
                <div id="preview-controls" class="button-group"></div>
                <div class="component-preview">
                    <svg id="config-preview-svg"></svg>
                </div>
                <div id="coordinate-display" class="coordinate-display">
                    X: --, Y: --
                </div>
                <hr>
                <h3>Parameter-Zusammenfassung</h3>
                <div id="parameter-summary-container">
                </div>
            </div>
        </div>
        <hr>
        <button type="submit">1. simulation.json erstellen</button>
    </form>

    <div id="simulation-runner" class="card initially-hidden">
        <h2>Simulation durchführen</h2>
        <p>Konfiguration wurde erfolgreich erstellt.</p>
        <button type="button" id="start-simulation-btn" class="button">2. Simulation starten</button>
        <div id="simulation-progress">
            <h4>Fortschritt:</h4>
            <pre><code id="simulation-output"></code></pre>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/configurator.js') }}"></script>
{% endblock %}